<?xml version="1.0"?>
<Container version="2">
  <Name>OpenCloud</Name>
  <Repository>opencloudeu/opencloud-rolling:latest</Repository>
  <Registry>https://hub.docker.com/r/opencloudeu/opencloud-rolling</Registry>
  <Network>bridge</Network>  <!-- Bridge-Modus für maximale Kompatibilität -->
  <Privileged>false</Privileged>
  <Support>https://github.com/syprix/unraid-opencloud</Support>
  <Project>https://opencloud.eu</Project>
  <Overview>OpenCloud mit externen Diensten (MariaDB, Redis, OnlyOffice)</Overview>
  <Category>Utility</Category>
  <WebUI>http://[IP]:[PORT:80]</WebUI>
  <TemplateURL>https://raw.githubusercontent.com/syprix/unraid-opencloud/main/unraid-template/opencloud.xml</TemplateURL>
  
  <!-- Alle notwendigen Parameter werden abgefragt -->
  <Configs>
    <Config Name="MariaDB Host" Target="MYSQL_HOST" Default="" Mode="" Description="IP/Hostname des MariaDB Servers"/>
    <Config Name="MariaDB Port" Target="MYSQL_PORT" Default="3306" Mode="" Description="Port der MariaDB Datenbank"/>
    <Config Name="MariaDB Datenbank" Target="MYSQL_DATABASE" Default="opencloud" Mode="" Description="Name der Datenbank"/>
    <Config Name="MariaDB Benutzer" Target="MYSQL_USER" Default="opencloud_user" Mode="" Description="Datenbank-Benutzername"/>
    <Config Name="MariaDB Passwort" Target="MYSQL_PASSWORD" Default="" Mode="password" Description="Datenbank-Passwort"/>
    <Config Name="Redis Host" Target="REDIS_HOST" Default="" Mode="" Description="IP/Hostname des Redis Servers"/>
    <Config Name="Redis Port" Target="REDIS_PORT" Default="6379" Mode="" Description="Redis Port"/>
    <Config Name="OnlyOffice URL" Target="ONLYOFFICE_DOCUMENT_SERVER_URL" Default="" Mode="" Description="Externe OnlyOffice URL (z.B. https://only.example.com)"/>
    <Config Name="Externe Domain" Target="OVERWRITEHOST" Default="" Mode="" Description="Ihre OpenCloud Domain (z.B. cloud.example.com)"/>
    <Config Name="Proxy IP" Target="TRUSTED_PROXIES" Default="" Mode="" Description="IP Ihres Reverse-Proxy Servers"/>
  </Configs>
  
  <Environment>
    <!-- Alle Variablen werden durch Benutzereingabe gesetzt -->
    <Variable Name="MYSQL_HOST" Value="${MYSQL_HOST}"/>
    <Variable Name="MYSQL_PORT" Value="${MYSQL_PORT}"/>
    <Variable Name="MYSQL_DATABASE" Value="${MYSQL_DATABASE}"/>
    <Variable Name="MYSQL_USER" Value="${MYSQL_USER}"/>
    <Variable Name="MYSQL_PASSWORD" Value="${MYSQL_PASSWORD}"/>
    <Variable Name="REDIS_HOST" Value="${REDIS_HOST}"/>
    <Variable Name="REDIS_PORT" Value="${REDIS_PORT}"/>
    <Variable Name="ONLYOFFICE_DOCUMENT_SERVER_URL" Value="${ONLYOFFICE_DOCUMENT_SERVER_URL}"/>
    <Variable Name="OVERWRITEHOST" Value="${OVERWRITEHOST}"/>
    <Variable Name="OVERWRITEPROTOCOL" Value="https"/> <!-- Immer HTTPS für Reverse-Proxy -->
    <Variable Name="TRUSTED_PROXIES" Value="${TRUSTED_PROXIES}"/>
  </Environment>
  
  <Data>
    <Volume Name="App Config" Target="/etc/opencloud" Mode="rw" Description="Konfigurationsverzeichnis"/>
    <Volume Name="App Data" Target="/var/lib/opencloud" Mode="rw" Description="Datenverzeichnis"/>
  </Data>
  
  <Labels>
    <Label Name="com.example.maintainer" Value="syprix"/>
  </Labels>
</Container>
